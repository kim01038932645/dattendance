<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 SRT Dì¡° ì¶œì„ë¶€</title>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #2c3e50; }
        
        /* ìˆœìœ„ ì„¹ì…˜ */
        .ranking-section { background: #eef2f3; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .ranking-list { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; list-style: none; padding: 0; }
        .ranking-item { background: white; padding: 5px 10px; border-radius: 4px; border-left: 4px solid #3498db; font-size: 0.9em; }

        /* ì¶œì„ í…Œì´ë¸” */
        .table-wrapper { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #3498db; color: white; position: sticky; top: 0; }
        tr:nth-child(even) { background: #f9f9f9; }
        .checkbox-cell { cursor: pointer; }
        
        select { padding: 10px; width: 200px; margin-bottom: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸƒâ€â™‚ï¸ SRT Dì¡° ì¶œì„ì²´í¬ (2026)</h1>

    <div class="ranking-section">
        <h2 id="ranking-title">1ì›” ì‹¤ì‹œê°„ ìˆœìœ„ (TOP 10)</h2>
        <ul id="ranking-list" class="ranking-list">
            </ul>
    </div>

    <div style="text-align: right;">
        <select id="month-select" onchange="renderTable()">
            <option value="0">1ì›”</option><option value="1">2ì›”</option>
            <option value="2">3ì›”</option><option value="3">4ì›”</option>
            <option value="4">5ì›”</option><option value="5">6ì›”</option>
            <option value="6">7ì›”</option>
        </select>
    </div>

    <div class="table-wrapper">
        <table id="attendance-table">
            <thead><tr id="table-header"></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>

<script>
    // 1. Firebase ì„¤ì • (ë³¸ì¸ì˜ í‚¤ë¡œ êµì²´ í•„ìš”)
    const firebaseConfig = {
  apiKey: "AIzaSyBX4hHNwF-TGwdgJpM12cMY2TcHwTU0j9w",
  authDomain: "dattendance-bc4a9.firebaseapp.com",
  databaseURL: "https://dattendance-bc4a9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dattendance-bc4a9",
  storageBucket: "dattendance-bc4a9.firebasestorage.app",
  messagingSenderId: "290320727452",
  appId: "1:290320727452:web:1e4896b79ce5af4fea1c59"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. ëª…ë‹¨ ë°ì´í„°
    const members = ["ê°•ë™í˜„", "ê°•ë™í›ˆ", "ì†¡ì±„í•œ", "ê¹€ë¯¸í™”", "ê¹€ì¬ì‚°", "ê¹€ì°¬ì„", "ê¹€í•œë‚˜", "ë¥˜ì§€ì°¬", "ë°•ì„±í™˜", "ë°•ì¢…ë´‰", "ì†Œë³‘ë“", "ì„œì •í™”", "ì‹ ì˜ì„­", "ì•ˆì§€í›ˆ", "ì˜¤í•œì²œ", "ì´ìŠ¹ì¤€", "ì´ìš©êµ¬", "ì •ë•ìˆ˜", "ì£¼íš¨ì„", "ì„œì¸ìˆ˜", "ë°•ì°½ì„ ", "ê¹€ë³‘ì‹"].sort();

    // 3. íŠ¹ì • ì›”ì˜ ìˆ˜ìš”ì¼, ì¼ìš”ì¼ ë‚ ì§œ êµ¬í•˜ê¸° (2026ë…„)
    function getMeetingDates(month) {
        let dates = [];
        let date = new Date(2026, month, 1);
        while (date.getMonth() === month) {
            if (date.getDay() === 0 || date.getDay() === 3) { // 0:ì¼, 3:ìˆ˜
                dates.push(new Date(date).toISOString().split('T')[0]);
            }
            date.setDate(date.getDate() + 1);
        }
        return dates;
    }

    // 4. ì¶œì„ ì²´í¬ ì €ì¥/ì‚­ì œ
    function toggleAttendance(name, date, isChecked) {
        const ref = db.ref(`srt_attendance/${date}/${name}`);
        if (isChecked) ref.set(true);
        else ref.remove();
    }

    // 5. í…Œì´ë¸” ë Œë”ë§ ë° ë°ì´í„° ë°”ì¸ë”©
    function renderTable() {
        const month = parseInt(document.getElementById('month-select').value);
        const dates = getMeetingDates(month);
        const header = document.getElementById('table-header');
        const body = document.getElementById('table-body');
        
        document.getElementById('ranking-title').innerText = `${month + 1}ì›” ì‹¤ì‹œê°„ ìˆœìœ„ (TOP 10)`;

        // í—¤ë” ìƒì„±
        header.innerHTML = '<th>ì´ë¦„</th>' + dates.map(d => `<th>${d.slice(5)}</th>`).join('');

        // ë°”ë”” ìƒì„±
        body.innerHTML = '';
        members.forEach(name => {
            let row = `<tr><td><b>${name}</b></td>`;
            dates.forEach(date => {
                row += `<td><input type="checkbox" id="${name}-${date}" onchange="toggleAttendance('${name}', '${date}', this.checked)"></td>`;
            });
            row += `</tr>`;
            body.innerHTML += row;
        });

        // ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ë° ìˆœìœ„ ê³„ì‚°
        db.ref('srt_attendance').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            const monthlyCounts = {};

            // ë°ì´í„° ë°˜ì˜ ë° ì´ë²ˆ ë‹¬ ì¶œì„ìˆ˜ ê³„ì‚°
            members.forEach(name => {
                let count = 0;
                dates.forEach(date => {
                    const isAttended = data[date] && data[date][name];
                    const cb = document.getElementById(`${name}-${date}`);
                    if(cb) cb.checked = !!isAttended;
                    if(isAttended) count++;
                });
                monthlyCounts[name] = count;
            });

            updateRanking(monthlyCounts);
        });
    }

    // 6. ìˆœìœ„ ì—…ë°ì´íŠ¸
    function updateRanking(counts) {
        const sorted = Object.entries(counts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10);

        const list = document.getElementById('ranking-list');
        list.innerHTML = sorted.map((item, index) => 
            `<li class="ranking-item"><b>${index + 1}ìœ„</b> ${item[0]} (${item[1]}íšŒ)</li>`
        ).join('');
    }

    // ì´ˆê¸° ì‹¤í–‰
    renderTable();
</script>

</body>
</html>